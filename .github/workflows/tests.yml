name: tests

on:
  pull_request:
  push:
    branches:
      - master
  schedule:
    - cron: '0 0 * * *'

jobs:

  tests:
    runs-on: ubuntu-20.04
    steps:
    - name: Prepare environment
      run: |
        set -eux
        sudo apt-get install -y qemu-system &
        dd if=/dev/zero of=archlinux.img bs=1MB count=4096
        mkfs.btrfs archlinux.img
        sudo mount archlinux.img /mnt
        sudo docker run --privileged -v /mnt:/newroot archlinux bash -c 'pacman -Sy --noconfirm arch-install-scripts && pacstrap /newroot base base-devel linux linux-firmware python python-pip xonsh'
        wait
        sudo chroot /mnt ls